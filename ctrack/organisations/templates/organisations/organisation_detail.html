{% extends "base.html" %}

{% block title %}
  {{ object.name }}
{% endblock %}

{% block content %}
  <div class="container mt-3" id="main-container">
    <div class="row">
      <div class="col-sm-12 pl-0 my-2">
        <div class="row" id="organisation-title">
          <div class="col-12">
            {% if object.oes %}
              <h4>{{ object.name }} | <span class="text-muted">{{ object.submode }}</span> <span
                      class="badge badge-success float-right">OES</span></h4>
            {% else %}
              <h4>{{ object.name }} | <span class="text-muted">{{ object.submode }}</span> <span
                      class="badge badge-secondary float-right">NOT OES</span></h4>
            {% endif %}
          </div>
        </div>
        <div class="row">
          <div class="col-3 text-muted">
            Last updated: {{ object.date_updated|date:"j M Y" }}
          </div>
        </div>

        <div class="row" id="top-row">

          <div class="col-md-12 my-2">
            <div class="card bg-light">
              <div class="card-body">
                <div class="card-title" style="font-size: 1.1rem;">Company Information</div>
                <div class="card-text">
                  <div>
                    <table class="table table-bordered">
                      <tr>
                        <td class="w-25"><strong>Designation Type:</strong></td>
                        <td>{{ object.designation_type }}</td>
                      </tr>
                      <tr>
                        <td class="w-25"><strong>OES:</strong></td>
                        {% if object.oes %}
                          <td>Yes</td>
                        {% else %}
                          <td><span class="text-danger">No</span></td>
                        {% endif %}
                      </tr>
                      <tr>
                        <td class="w-25"><strong>Registered Company Name:</strong></td>
                        <td>{{ object.registered_company_name }}</td>
                      </tr>
                      <tr>
                        <td class="w-25"><strong>Date Updated:</strong></td>
                        <td>{{ object.date_updated }}</td>
                      </tr>
                      <tr>
                        <td class="w-25"><strong>Updated By:</strong></td>
                        <td>REMOVED</td>
                      </tr>
                      <tr>
                        <td class="w-25"><strong>Active:</strong></td>
                        <td>{{ object.active }}</td>
                      </tr>
                      <tr>
                        <td class="w-25"><strong>Comments:</strong></td>
                        <td>{{ object.comments }}</td>
                      </tr>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="col-md-12 mb-2">

            <div class="row pb-2">
              <div class="col-sm">
                <div class="card bg-light">
                  <div class="card-body">
                    <div class="card-title" style="font-size: 1.1rem;">Essential Services</div>
                    <table class="table table-bordered">
                      {% if applicable_systems|length > 0 %}
                        {% for es in essential_services %}
                          <tr>
                            <td style="width: 30%"><a
                                    href="{% url "organisations:essential_service_detail" es.pk %}">{{ es.name }}</a>
                            </td>
                            <td>{{ es.description }}
                            </td>
                          </tr>
                        {% endfor %}
                      {% else %}
                        <p>button to create new one here</p>
                      {% endif %}
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <div class="row pb-2">
              <div class="col-sm">
                <div class="card bg-light">
                  <div class="card-body">
                    <div class="card-title" style="font-size: 1.1rem;">NIS Systems <a
                            href="{% url "caf:as_create_from_org" object.slug %}"
                            class="btn btn-outline-primary btn-sm float-right">Add
                      new...</a>
                    </div>
                    <div class="table">
                      <table class="table table-bordered">
                        {% if applicable_systems|length > 0 %}
                          {% for ass in applicable_systems %}
                            <tr>
                              <td><a href="{% url "caf:ass_detail" ass.id %}">{{ ass.name }}</a></td>
                              <td>{{ ass.function }}
                              </td>
                            </tr>
                          {% endfor %}
                        {% else %}
                          <a class="btn btn-primary" href="{% url "caf:as_create_from_org" object.slug %}"
                             role="button">Add
                            new...</a>
                        {% endif %}
                      </table>
                    </div>
                  </div>
                </div>
              </div>

            </div>

          </div>
        </div>


        <div class="row">
          <div class="col-md-12 my-2">
            <div class="card bg-light">
              <div class="card-body">
                <div class="card-title" style="font-size: 1.1rem;">CAFs <a href="#"
                                                                           class="btn btn-outline-primary btn-sm float-right">Add
                  new...</a></div>
                <div class="table-responsive">
                  <table class="table table-sm table-striped table-bordered">
                    <thead>
                    <tr>
                      <th>Version</th>
                      <th>Quality Grading</th>
                      <th>Confidence Grading</th>
                      <th>File Container</th>
                      <th>Container Type</th>
                      <th>File Location</th>
                      <th>Assessments</th>
                      <th>Comments</th>
                    </tr>
                    </thead>
                    {% if cafs|length > 0 %}
                      {% for caf in cafs %}
                        <tr>
                          <td>
                            <a href="{% url "caf:detail" caf.pk %}">{{ caf.version }}</a>
                          </td>
                          <td>
                            {{ caf.quality_grading }}
                          </td>
                          <td>
                            {{ caf.confidence_grading }}
                          </td>
                          <td>
                            {{ caf.file.name }}
                          </td>
                          <td>
                            {{ caf.file.type }}
                          </td>
                          <td>
                            {{ caf.file.file_store_location }}
                          </td>
                          <td>
                            <ul class="list-group">
                              {% for ass in caf.cafassessment_set.all %}
                                <li class="list-group-item">{{ ass }} by <a
                                        href="{% url "organisations:person-detail" ass.completer.pk %}">{{ ass.completer }}</a>
                                </li>
                              {% endfor %}
                            </ul>
                          </td>
                          <td>
                            <ul class="list-group">
                              <li class="list-group-item">
                                {{ caf.comments }}</li>
                            </ul>
                          </td>
                        </tr>
                      {% endfor %}
                    {% else %}
                      <a class="btn btn-primary" href="{% url "caf:as_create_from_org" object.slug %}" role="button">Add
                        new...</a>
                    {% endif %}
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-12 my-2">
            <div class="card bg-light">
              <div class="card-body">
                <div class="card-title" style="font-size: 1.1rem;">
                  Engagements & Compliance Events
                  <a href="{% url "register:create" object.slug %}" class="btn btn-outline-primary btn-sm float-right">Add
                    new...</a>
                </div>

                <div class="table table-responsive">
                  <table class="table table-sm table-striped table-bordered">
                    <thead>
                    <tr>
                      <th>Date</th>
                      <th>Type</th>
                      <th>Description</th>
                      <th>CAF</th>
                      <th>Response Requested</th>
                      <th>Response Due</th>
                      <th>Actions</th>
                    </tr>
                    </thead>
                    {% if engagement_events|length > 0 %}
                      {% for event in engagement_events %}
                        <tr>
                          <td>{{ event.date |date:"d M Y" }}</td>
                          <td>{{ event.type }}</td>
                          <td><a href="#">{{ event.short_description }}</a></td>
                          {% if event.related_caf %}
                            <td><a href="{% url "caf:detail" event.related_caf.id %}">{{ event.related_caf }}</a></td>
                          {% else %}
                            <td>NA</td>
                          {% endif %}
                          {% if event.response_date_requested %}
                            <td style="color: {{ event.days_to_response_due.descriptor }}">{{ event.response_date_requested |date:"D d M Y" }}</td>
                          {% else %}
                            <td>NA</td>
                          {% endif %}
                          {% if event.response_received %}
                            <td>{{ event.response_received | date:"D d M Y" }}</td>
                          {% else %}
                            {% if event.response_date_requested %}
                              <td style="color: {{ event.days_to_response_due.descriptor }};">{{ event.days_to_response_due.days }} {{ event.days_to_response_due.day_str }}</td>
                            {% else %}
                              <td>NA</td>
                            {% endif %}
                          {% endif %}
                          <td><a class="badge badge-success" href="#" role="button">Edit</a> <a
                                  href="{% url "register:ee_delete" event.pk object.slug %}" class="badge badge-danger"
                                  role="button">Delete</a></td>
                        </tr>
                      {% endfor %}
                    {% endif %}
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12 mt-3">
            <h4>People</h4>
          </div>
        </div>
        <div class="row">
          {% for p in people %}
            <div class="col-md-12 my-2">
              <div class="card bg-light">
                <div class="card-body">
                  <h5 class="card-title"><a
                          href="{% url "organisations:person-detail" p.id %}">{{ p.first_name }} {{ p.last_name }}</a>
                  </h5>
                  <h6 class="card-subtitle mb-2 text-muted">{{ p.job_title }}</h6>
                  <div class="table-responsive">
                    <table class="table-sm">
                      <tr>
                        <td>Primary NIS Contact:</td>
                        {% if p.primary_nis_contact %}
                          <td class="text-success">Yes</td>
                        {% else %}
                          <td>No</td>
                        {% endif %}
                      </tr>
                      <tr>
                        <td>Email:</td>
                        <td><a href="mailto:{{ p.email }}">{{ p.email }}</a></td>
                      </tr>
                      <tr>
                        <td>Mobile:</td>
                        <td>{{ p.mobile }}</td>
                      </tr>
                      <tr>
                        <td>Landline:</td>
                        <td>{{ p.landline }}</td>
                      </tr>
                      <tr>
                        <td>Clearance:</td>
                        <td>{{ p.clearance }}</td>
                      </tr>
                      <tr>
                        <td>Clearance Expiry:</td>
                        <td>{{ p.clearance_expiry }}</td>
                      </tr>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>


        <div class="row">
          <div class="col-12 mt-3">
            <h4>Addresses</h4>
          </div>
        </div>
        <div class="row">
          {% if no_addr > 1 %}
            {% for a in addr %}
              <div class="col-md-12 my-2">
                <div class="card bg-light">
                  <div class="card-body">
                    <div class="card-title text-muted mb-1">{{ a.type }}</div>
                    <div>
                      <table class="table table-responsive table-bordered">
                        <tr>
                          <td>{{ a.line1 }} {{ a.line2 }}</td>
                        </tr>
                        <tr>
                          <td>{{ a.line3 }}</td>
                        </tr>
                        <tr>
                          <td>{{ a.city }}</td>
                        </tr>
                        <tr>
                          <td>{{ a.county }}</td>
                        </tr>
                        <tr>
                          <td>{{ a.postcode }}</td>
                        </tr>
                        <tr>
                          <td>{{ a.country }}</td>
                        </tr>
                        <tr>
                          <td>
                            <div class="text-muted mb-1 mt-2">Notes:</div>
                            {{ a.other_details }}
                          </td>
                        </tr>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="col-md-12 my-2">
              <div class="card bg-light">
                <div class="card-body">
                  <div class="card-title mb-1 text-muted">{{ addr.type }}</div>
                  <table class="table-sm table-bordered">
                    <tr>
                      <td>{{ addr.line1 }} {{ addr.line2 }}</td>
                    </tr>
                    <tr>
                      <td>{{ addr.line3 }}</td>
                    </tr>
                    <tr>
                      <td>{{ addr.city }}</td>
                    </tr>
                    <tr>
                      <td>{{ addr.county }}</td>
                    </tr>
                    <tr>
                      <td>{{ addr.postcode }}</td>
                    </tr>
                    <tr>
                      <td>{{ addr.country }}</td>
                    </tr>
                    <tr>
                      <td>
                        <div class="text-muted mb-1 mt-2">Notes:</div>
                        {{ addr.other_details }}
                      </td>
                    </tr>
                  </table>
                </div>
              </div>
            </div>
          {% endif %}
        </div>


      </div>
    </div>
  </div>
  </div>
{% endblock content %}
